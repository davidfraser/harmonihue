<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns:py="http://genshi.edgewall.org/" xml:space="preserve">
<?python
from book_helpers import *
strings = ["E", "A", "D", "G", "B", "E"]
units = "cm"
edge_string_gap = 0.5
# the gap between strings is the distance between the top and bottom strings divided by the gaps
string_gap = 4.4/(len(strings)-1)
string_length = 65
string_width = 0.1
frets = 19
dotted_frets = [5, 7, 9, 12]
fret_width = 0.2
sticker_width = 0.5
sticker_height = 0.6
show_guitar = False

string_pos = [(edge_string_gap + string_gap*s) for s in range(len(strings))]
fretboard_height = (edge_string_gap*2) + string_gap*(len(strings)-1)
fret_height = fretboard_height
fret_pos = [string_length/(2**(fret/12.)) for fret in range(frets+1)]
fret_cpos = [(fret_pos[fret]+fret_pos[fret+1])/2 for fret in range(frets)]
hue_cycle = list(tone_cycle(7))
colors = get_lab_spread_colors(saturation=1.0, value=0.6)
hue_colors = [colors[hue_cycle.index((index)%12)] for index in range(12)]
dot_colour = "white" if show_guitar else "black"
?>
<rect py:if="show_guitar" id="fretboard" style="fill: #552200;" x="${fret_pos[-1]}${units}" y="0${units}" width="${string_length - fret_pos[-1]}${units}" height="${fretboard_height}${units}"/>
<div py:for="s, string in enumerate(strings)" py:strip="True">
    <div py:for="fret in range(frets)" py:strip="True" py:with="note_index=(tones.index(string)+fret)%12">
        <rect id="sticker_${string}${s}_${fret}" style="fill: ${hue_colors[note_index].html}; stroke: black;" x="${fret_cpos[fret]-sticker_width/2}${units}" y="${string_pos[s]-sticker_height/2}${units}" width="${sticker_width}${units}" height="${sticker_height}${units}"/>
    </div>
</div>
<div py:if="show_guitar" py:strip="True">
    <rect id="" style="fill: white; stroke: white;" x="${string_length}${units}" y="${fret_pos[0]}${units}" width="${fret_width*2}${units}" height="${fret_height}${units}"/>
    <rect id="fret_${fret}" py:for="fret in range(1, frets)" style="fill: gold; stroke: gold;" x="${fret_pos[fret]}${units}" y="0${units}" width="${fret_width}${units}" height="${fret_height}${units}"/>
    <rect py:for="s, string in enumerate(strings)" id="string_${string}${s}" style="fill: silver; stroke: silver;" x="0${units}" y="${string_pos[s]}${units}" width="${string_length}${units}" height="${string_width}${units}"/>
</div>
<rect id="fret_dot_${fret}" py:for="fret in dotted_frets" style="fill: ${dot_colour}; stroke: ${dot_colour};" x="${fret_cpos[fret]-0.1}${units}" y="0.1${units}" width="0.2${units}" height="0.1${units}"/>
</svg>

