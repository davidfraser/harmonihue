<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:py="http://genshi.edgewall.org/">
<head>
<title>Harmonic Hues</title>
<?python
from book_helpers import *
?>
</head>
<body>
<h1>Harmonic Hues</h1>

<h2>Introduction</h2>
<p>This is a system for relating musical pitch to visual phenomenen (especially colour). The aim is to find a correspondence between these different concepts that will function intuitively, especially in conveying the harmonic relationships between different pitches.</p>

<h3>Background</h3>
<p>My daughter has a little keyboard - you blow into it, and press down the notes, and depending on whether a note is depressed or not, the sound is directed to an output pipe of the appropriate pitch. The keyboard follows the normal piano keyboard layout, except that the keys that are normally "white" are coloured. All the keys are also numbered, but the "black" keys remain black. There's a book that accompanies it with music for some simple songs - written in the normal musical script, but the note heads are coloured to correspond to the colours on the keyboard.</p>
<p>This struck me as being inadequate and non-optimal, since there seemed to be no real rationale between the colours chosen - and of course the distinction between "black" and "white" keys seemed arbritrary.</p>
<p>At the same time I was talking to a friend who was doing a simple spectogram visualisation of sound, and thinking that it would be great if you could see the harmonic relationship between different frequencies - perhaps a spiral arrangement where each successive octave was at the same angle from the center would mean that musically equivalent intervals would have a direct geometric counterpart.</p>
<p>These ideas led naturally to the questions and results below.</p>

<h3>Goal: Colouring Notes</h3>
<p>Is it possible to map the set of pitch-frequencies in the Western 12-tone scale onto a set of colours, in such a way that:</p>
<ul>
    <li>Any two frequencies with the same pitch (i.e. a whole number of octaves apart) have the same colour</li>
    <li>The visual difference between two pitches is approximately proportional to how harmonious or dischordant they are when played together - so that a perfect fifth would be much closer than an augmented fourth</li>
</ul>

<h4>Notes on Pitch</h4>
<p>The twelve-tone system was derived as a compromise between the natural harmonics generated on physical instruments, and the desire to be able to play in different keys without complicated tuning. The following chart demonstrates the different harmonics and the intervals that they generate when applied repeatedly but reduced to the same octave, and compares them to the even-tempered scale. The labels on the dots indicate the number of times the interval has been repeated from the base interval (and the fading is greater for a greater number of repetitions)</p>

<p><img src="${draw_even_temper.save()}"/></p>

<p>This illustrates how the frequencies generated by repeating a perfect fifth match very closely to the even-tempered scale, and how it produces a good approximation for major thirds as well.</p>

<h3>Some Maths</h3>
<p>Starting with that basic idea leads immediately to the following:</p>
<ul>
    <li>The visual difference between pitches should be constant for any particular interval</li>
</ul>
<p>If we treat the pitch-space and the colour-space as two spaces, with a mapping between them, we can define this mathematically.</p>

<h4>Harmonic Difference</h4>
<p>The first goal is to find a function <tt>hd</tt> that approximates the <i>harmonic difference</i> between two frequencies. The result should be low for frequencies that are close harmonies of each other, and high for frequencies that aren't. Different octaves of the same tone will have zero harmonic difference. The function is a metric between the points in the frequency space.</p>
<pre>
hd(a, a) = 0                    # identity
hd(a, 2a) = 0                   # octaves
hd(a, b) = hd(b, a)             # commutative
hd(a, b) = hd(a, 2b)            # octaves
hd(a, b) + hd(b, c) &gt;= hd(a, c) # convex ?
hd(a, b) = hd(ra, rb)           # transposition
hd(a, 3a) = 1                   # perfect fifth set
</pre>

<h4>Distance around the circle of fifths</h4>
<p>A <b>circle of fifths</b> may be produced where the twelve tones are arranged into a cycle where adjacent tones are separated by a perfect fifth (7 semi-tones). (This is the only fixed-interval cycle that covers the whole twelve-tone scale, since (1, 11) and (5, 7) are the only pairs of numbers below 12 that are relatively prime to 12). This is advantageous because a perfect fifth is the closest harmony other than an octave, being derived from dividing a pitch by 3 (the lowest natural number other than 2 which produces octaves).</p>
<p>This can be displayed visually in a circle as follows:</p>
<table>
<tr>
<td><img src="${draw_tone_circle.save(1)}"/></td><td><img src="${draw_tone_circle.save(7)}"/></td>
</tr></table>
<p>Basing the difference directly on the distance between two points on the circle of fifths is simple; the first table contains tones in the order of the circle of fifths, the second on their standard pitch-based order:</p>
<table style="border: 1px solid grey;">
<tr><th style="text-align: left;">Tone</th><td style="width: 3em;" py:for="i in tone_cycle(7)"><tt>${tones[i]}</tt></td></tr>
<tr><th style="text-align: left;">Index</th><td py:for="i in tone_cycle(7)"><tt>${i}</tt></td></tr>
<tr><th style="text-align: left;">Position</th><td py:for="i in range(12)"><tt>${i}</tt></td></tr>
</table>
<table style="border: 1px solid grey;">
<tr><th style="text-align: left;">Tone</th><td style="width: 3em;" py:for="tone in tones"><tt>${tone}</tt></td></tr>
<tr><th style="text-align: left;">Index</th><td py:for="i in range(12)"><tt>${i}</tt></td></tr>
<tr><th style="text-align: left;">Position</th><td py:for="i in range(12)"><tt>${tone_cycle_pos(i, 7)}</tt></td></tr>
</table>
<p>The equation <tt>hd(a, b) = p(a) - p(b) (mod 12)</tt> then trivially satisfies some of the above conditions for harmonic difference.</p>

<h4>Geometry</h4>
<?python
MATPLOTLIB_COLORS = list(get_matplotlib_colors())
?>
<p>In pitch, there are twelve tones. Because 12 is not a prime, intervals of 2, 3, 4 and 6 semitones form cycles: The intervals generated by repeated major thirds (4 semitones) comprise an "equilateral triangle" - each side must be the same length. Likewise the intervals generated by repeated minor thirds (3 semitones) comprise a "square" - each side must be the same length. Major seconds (2 semitones) generate two hexagons, and augmented fourths (6 semitones) generate 6 pairs of numbers.</p>
<p>The following table demonstrates these cycles on both the circle of fifths and the circle of semitones</p>
<table>
<tr><th>Interval</th><th>Cycle</th><th>Circle of fifths</th><th>Circle of Semitones</th></tr>
<tr py:for="interval in range(1, 7)">
<th>${interval}<span py:strip="True" py:if="interval != 6"> / ${12-interval}</span></th>
<td>
<table py:for="offset in range(0, (interval if (12 % interval == 0) else 1))" py:with="offset_color=MATPLOTLIB_COLORS[offset]">
<tr><td style="width: 3em; color: ${offset_color};" py:for="i in tone_cycle(interval, offset)">${tones[i]}</td></tr></table>
</td>
<td>
  <img src="${draw_tone_cycles.save(interval, 7)}"/>
</td>
<td>
  <img src="${draw_tone_cycles.save(interval, 1)}"/>
</td>
</tr>
</table>
<h4>Colour Mapping</h4>
<p>The simplest way to map such a cyclical system to the colour space is to use the concept of "hue" (which corresponds to the most basic concept of colours - the rainbow is the most classic example of this, and it forms a cyclical space). Using the HSV colour space ...</p>

</body>
</html>
