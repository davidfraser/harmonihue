<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:py="http://genshi.edgewall.org/">
<head>
<title>Harmonic Hues</title>
<?python
from book_helpers import *
MATPLOTLIB_COLORS = list(get_matplotlib_colors())
?>
</head>
<body>
<h1>Harmonic Hues</h1>

<h2>Introduction</h2>
<p>This is a system for relating musical pitch to visual phenomenen (especially colour). The aim is to find a correspondence between these different concepts that will function intuitively, especially in conveying the harmonic relationships between different pitches.</p>

<h3>Goal: Visualizing Notes with Colour</h3>
<p>Is it possible to map the set of pitch-frequencies in the Western 12-tone scale onto a set of colours, in such a way that:</p>
<ul>
    <li>Any two frequencies with the same pitch (i.e. a whole number of octaves apart) have the same colour</li>
    <li>The visual difference between two pitches is approximately proportional to how harmonious or dischordant they are when played together - so that a perfect fifth would be much closer than an augmented fourth</li>
</ul>

<h3>Background</h3>
<p>My daughter has a little keyboard - you blow into it, and press down the notes, and depending on whether a note is depressed or not, the sound is directed to an output pipe of the appropriate pitch. The keyboard follows the normal piano keyboard layout, except that the keys that are normally "white" are coloured. All the keys are also numbered, but the "black" keys remain black. There's a book that accompanies it with music for some simple songs - written in the normal musical script, but the note heads are coloured to correspond to the colours on the keyboard.</p>
<p>This struck me as being inadequate and non-optimal, since there seemed to be no real rationale between the colours chosen - and of course the distinction between "black" and "white" keys seemed arbritrary.</p>
<p>At the same time I was talking to a friend who was doing a simple spectogram visualisation of sound, and thinking that it would be great if you could see the harmonic relationship between different frequencies - perhaps a spiral arrangement where each successive octave was at the same angle from the center would mean that musically equivalent intervals would have a direct geometric counterpart.</p>
<p>These ideas led naturally to the investigation and results below.</p>

<h3>Some Musical Maths</h3>

<h4>The Twelve-Tone Scale</h4>
<p>The twelve-tone system was derived as a compromise between the natural harmonics generated on physical instruments, and the desire to be able to play in different keys without complicated tuning. The following chart demonstrates the different harmonics and the intervals that they generate when applied repeatedly but reduced to the same octave, and compares them to the even-tempered scale. The labels on the dots indicate the number of times the interval has been repeated from the base interval (and the fading is greater for a greater number of repetitions)</p>

<p><img src="${draw_even_temper.save()}"/></p>

<p>This illustrates how the frequencies generated by repeating a perfect fifth match very closely to the even-tempered scale, and how it produces a good approximation for major thirds as well.</p>

<h4>The circle of fifths</h4>
<p>A <b>circle of fifths</b> may be produced where the twelve tones are arranged into a cycle where adjacent tones are separated by a perfect fifth (7 semi-tones). (This is the only fixed-interval cycle that covers the whole twelve-tone scale, since (1, 11) and (5, 7) are the only pairs of numbers below 12 that are relatively prime to 12).</p>
<p>The twelve tones can be displayed visually in a circle either in standard order, or in the circle of fifths:</p>
<table>
 <tr><th>Semitone Order</th><th>Fifths Order</th></tr>
 <tr><td><img src="${draw_tone_circle.save(1)}"/></td><td><img src="${draw_tone_circle.save(7)}"/></td></tr>
</table>

<h4>Harmonic Space</h4>

<p>Let's first try to establish the mathematical relationship between notes more carefully. Since we are looking to quantify differences between different notes, this can be represented by picturing the notes as arranged in a space, where the distance between the notes corresponds to how discordant those two notes sound when played together.</p>

<p>We'll then require a function <tt>hd</tt> that is a <i>metric</i> on the frequency space, which approximates the <i>harmonic difference</i> between two frequencies. The result should be low for frequencies that are close harmonies of each other, and high for frequencies that aren't. The following principles will apply:</p>
<table>
 <tr><th>Principle</th><th>Mathematical Formulation</th></tr>
 <tr><td>Notes are perfectly harmonious with themselves</td><td><tt>hd(a, a) = 0</tt></td></tr>
 <tr><td>Notes exactly an octave a part are equivalent</td><td><tt>hd(a, 2a) = 0</tt></td></tr>
 <tr><td>Harmonic difference is independent of direction (commutative)</td><td><tt>hd(a, b) = hd(b, a)</tt></td></tr>
 <tr><td>Harmonic difference is constant for any interval - therefore independent under transposition</td><td><tt>hd(a, b) = hd(ra, rb)</tt></td></tr>
</table>

<p>The circle of fifths is advantageous because a perfect fifth is the closest harmony other than an octave, being derived from dividing a pitch by 3 (the lowest natural number other than 2 - which produces octaves)</p>
<p>Basing the difference directly on the distance between two points on the circle of fifths is simple; the first table contains tones in the order of the circle of fifths, the second on their standard pitch-based order:</p>
<table style="border: 1px solid grey;">
 <tr><th style="text-align: left;">Tone</th><td style="width: 3em;" py:for="i in tone_cycle(7)"><tt>${tones[i]}</tt></td></tr>
 <tr><th style="text-align: left;">Index</th><td py:for="i in tone_cycle(7)"><tt>${i}</tt></td></tr>
 <tr><th style="text-align: left;">Position</th><td py:for="i in range(12)"><tt>${i}</tt></td></tr>
</table>
<table style="border: 1px solid grey;">
 <tr><th style="text-align: left;">Tone</th><td style="width: 3em;" py:for="tone in tones"><tt>${tone}</tt></td></tr>
 <tr><th style="text-align: left;">Index</th><td py:for="i in range(12)"><tt>${i}</tt></td></tr>
 <tr><th style="text-align: left;">Position</th><td py:for="i in range(12)"><tt>${tone_cycle_pos(i, 7)}</tt></td></tr>
</table>

<p>The equation <tt>hd(a, b) = p(a) - p(b) (mod 12)</tt> (where <tt>p</tt> is the position in the circle of fifths) represents this distance, which then trivially satisfies some of the above conditions for harmonic difference. However, we have not yet investigated the relative dischordancy of intervals, or explored the structure of this harmonic space.</p>

<h4>Geometry of intervals in the twelve-tone-space</h4>
<p>Because 12 is not a prime, intervals of 2, 3, 4 and 6 semitones form cycles: The intervals generated by repeated major thirds (4 semitones) comprise an "equilateral triangle" - each side must be the same length. Likewise the intervals generated by repeated minor thirds (3 semitones) comprise a "square" - each side must be the same length. Major seconds (2 semitones) generate two hexagons, and augmented fourths (6 semitones) generate 6 pairs of numbers.</p>
<p>The following table demonstrates these cycles on both the circle of fifths and the circle of semitones</p>
<table>
    <tr><th>Interval</th><th>Cycle</th><th>Circle of fifths</th><th>Circle of Semitones</th></tr>
    <tr py:for="interval in range(1, 7)">
        <th>${interval}<span py:strip="True" py:if="interval != 6"> / ${12-interval}</span></th>
        <td>
        <table py:for="offset in range(0, (interval if (12 % interval == 0) else 1))" py:with="offset_color=MATPLOTLIB_COLORS[offset]">
        <tr><td style="width: 3em; color: ${offset_color};" py:for="i in tone_cycle(interval, offset)">${tones[i]}</td></tr></table>
        </td>
        <td>
          <img src="${draw_tone_cycles.save(interval, 7)}"/>
        </td>
        <td>
          <img src="${draw_tone_cycles.save(interval, 1)}"/>
        </td>
    </tr>
</table>

<h4>Relative Dischordancy</h4>

<p>We've already defined octaves as of no distance. The next purest interval is a perfect fifth (dividing frequency by 3), followed by a major third (dividing it by 5). Generally in western music the order of dischordancy is clear (starting with least dischordant):</p>
<table>
 <tr><th>Interval</th><th>Semitones</th><th>Inverse Interval</th><th>Semitones</th></tr>
 <tr><td>Unison</td><td>0</td><td>Octave</td><td>12</td></tr>
 <tr><td>Perfect Fifth</td><td>7</td><td>Perfect Fourth</td><td>5</td></tr>
 <tr><td>Major Third</td><td>4</td><td>Minor Sixth</td><td>8</td></tr>
 <tr><td>Minor Third</td><td>3</td><td>Major Sixth</td><td>9</td></tr>
 <tr><td>Whole Tone</td><td>2</td><td>Minor Seventh</td><td>10</td></tr>
 <tr><td>Semitone</td><td>1</td><td>Major Seventh</td><td>11</td></tr>
 <tr><td>Augmented Fourth</td><td>6</td><td>Diminished Fifth</td><td>6</td></tr>
</table>
<p>This assumes that the dischordancy of an interval is exactly the same as its inverse (which we've assumed above, and which makes a metric space easier, although it may not be exactly true in practice).</p>

<p>We can express this as:<br/>
<tt>0 = d(0) &lt; d(5) &lt; d(4) &lt; d(3) &lt; d(2) &lt; d(1) &lt; d(6)</tt></p>

<p>However, simply using the circle of fifths generates the following order instead:<br/>
<tt>0 = d(0) &lt; d(5) &lt; d(2) &lt; d(3) &lt; d(4) &lt; d(1) &lt; d(6)</tt></p>

<p>This is so using any measure that simply orders based on the circle of fifths, since whole tones end up before major thirds in that order. The two most obvious ones are radial distance around the circle and distance of a straight line across the circle in two dimensions.</p>

<h4>A Tuneful Torus</h4>

<p>In order to modify the order whilst still retaining the same basic structure, let's consider an extension of the circle to a <i>torus</i> (or doughnut shape in 3 dimensions). The aim is to increase the distance for the whole tone (the second repeat of the perfect fifth), whilst reducing it for the major third and minor third (the third and fourth repeats). It's important that the whole structure needs to preserve the symmetries we discovered above.</p>

<p>Define the distance between two points on the surface of the torus as the sum of the (scaled) differences of their <i>toroidal</i> angle (from the center - &gamma;) and their <i>poloidal</i> angle (around the small circle of the ring - &theta;). Then we want to maximize &theta; for <tt>d(2)</tt> whilst minimizing it for <tt>d(4)</tt> and <tt>d(3)</tt>. This can be accomplished by arranging the points in a spiral around the "ring" of the doughnut so that a whole tone results in moving to the opposite side, but another whole tone comes back to the same &theta;-position - which implies that each semitone will move 90&deg; around the ring.</p>

<p><img src="${draw_torus.save()}"/></p>

<table>
    <tr><th>Interval</th><th>Toroidal Angle (&gamma;)</th><th>Poloidal Angle (&theta;)</th><th>Distance (2&gamma; + &theta;)</th></tr>
    <tr py:for="semitones in [0, 7, 4, 3, 2, 1, 6]" py:with="gamma=mod_delta(0, tone_cycle_pos(semitones, 7, 0), 12); theta=mod_delta(0, semitones, 4)">
       <td>${semitones}</td>
       <td>${gamma}*&pi;/6</td>
       <td>${theta}*&pi;/2</td>
       <td>${2*gamma+theta*3}*&pi;/6</td>
    </tr>
</table>

<p>The geometrical patterns we saw earlier for tone cycles can also be <a href="torus-tone-geometry.html">visualized on this torus projection</a>. Scales and chords also show <a href="scale-diagrams.html">interesting patterns on the circle of fifths</a> in either space.</p>

<h3>Colour Theory</h3>

<p>Colours can also be modeled using "spaces". Two simple ways are through the RGB colour space (which comprises the levels of red, green, and blue light that our eyes perceive), and through the HSV colour space which rather uses the dimensions of Hue, Saturation and Value. A more sophisticated kind of colour space is represented by the CIELAB colour space, in which the distance between points in the space corresponds directly to the perceived difference between the colours to a human viewer.</p>

<h4>Topology</h4>

<p>The colour spaces are generally three-dimensional (given the three different kinds of cone cell receptors in the human eye, with sensitivies to different ranges of frequences), and are approximately cylindrical, spherical or cubic depending on the nature of the model:<br/>
  <ul>
    <li>The <b>RGB</b> colour space is <b>cubic</b> - each component varies from 0 to 1</li>
    <li>The <b>HSV</b> colour space is <b>cylindrical</b> - the Hue component is circular (cycling around the colours of the rainbow), the Saturation value is usually taken from the center of the cylinder to the edge, and the Value parameter as from the bottom to the top of the cylinder</li>
    <li>The <b>Lab</b> colour space can handle colours outside the human range of perception; the range of values meaningful to humans corresponds to a kind of distorted cube</li>
  </ul>
</p>

<h3>Colour Mapping</h3>

<p>We have so far two spaces for <a title="You model tones with one L - they're not very L-ish">modeling</a> tones (the circle of fifths, and the more complex but satisfying torus space), and a number of spaces for <a title="You model colours with two Ls. Really">modelling</a> colours. Let's now consider appropriate mappings between the spaces.</p>

<p>The key feature of the tone spaces is that they are cyclical. The only colour space that is directly cyclical is the HSV colour space, in the hue dimension. As a first attempt, let's map the circle of fifths onto the hue dimension whilst keeping saturation and value fixed.</p>

<table>
 <tr><th>Fifths Order</th><th>Semitone Order</th></tr>
 <tr><td><img src="${draw_hue_tone_circle.save(7)}"/></td><td><img src="${draw_hue_tone_circle.save(1)}"/></td></tr>
</table>

</body>
</html>
